<!DOCTYPE html>
<html>
<head>
    <title>文本相似度计算</title>
    <script>
    function calculateBulkSimilarity() {
        var referenceText = document.getElementById("referenceText").value;
        var testTexts = Array.from(document.querySelectorAll(".testText")).map(element => element.value);
        var cosineWeight = document.getElementById("cosineWeight").value;
        var euclideanWeight = document.getElementById("euclideanWeight").value;
        var manhattanWeight = document.getElementById("manhattanWeight").value;

        fetch('/modified_bulk_similarity', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                reference_text: referenceText,
                texts_to_compare: testTexts,
                weights: {
                    cosine: parseFloat(cosineWeight),
                    euclidean: parseFloat(euclideanWeight),
                    manhattan: parseFloat(manhattanWeight),
                }
            }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if(data.similarities && data.similarities.length > 0) {
                var results = data.similarities;
                var resultTable = "<table><tr><th>测试文本</th><th>相似度得分</th></tr>";
                results.forEach((result, index) => {
                    resultTable += `<tr><td>测试文本 ${index + 1}</td><td>${result}</td></tr>`;
                });
                resultTable += "</table>";
                document.getElementById("bulkResult").innerHTML = resultTable;
            } else {
                document.getElementById("bulkResult").innerHTML = "没有计算出相似度。";
            }
        })
        .catch((error) => {
            console.error('Error:', error);
            document.getElementById("bulkResult").innerHTML = "发生错误，无法计算相似度。";
        });
    }

    function addTextField() {
        var container = document.getElementById("testTextsContainer");
        var newField = document.createElement("textarea");
        newField.setAttribute("rows", "2");
        newField.setAttribute("cols", "50");
        newField.classList.add("testText");
        container.appendChild(newField);
    }
    </script>
</head>
<body>
    <h2>输入目标文本与多个测试文本，返回相似度</h2>
    <div>
        <label for="referenceText">目标文本:</label><br>
        <textarea id="referenceText" rows="4" cols="50"></textarea>
    </div>
    <div id="testTextsContainer">
        <label>测试文本:</label><br>
        <textarea class="testText" rows="2" cols="50"></textarea>
        <textarea class="testText" rows="2" cols="50"></textarea>
    </div>
    <button type="button" onclick="addTextField()">添加测试文本</button>
    
    <h3>相似度计算参数配置</h3>
    <p>请根据需要调整以下参数以优化相似度计算结果。</p>
    <div>
        <label for="cosineWeight">余弦相似度权重:</label>
        <input type="number" id="cosineWeight" value="1" step="0.1" min="0" max="1"><br>
        <label for="euclideanWeight">欧氏距离权重:</label>
        <input type="number" id="euclideanWeight" value="0" step="0.1" min="0" max="1"><br>
        <label for="manhattanWeight">曼哈顿距离权重:</label>
        <input type="number" id="manhattanWeight" value="0" step="0.1" min="0" max="1"><br>
    </div>
    <p>注意：权重之和应为1，以保证相似度得分的准确性。</p>
    <input type="button" value="计算相似度" onclick="calculateBulkSimilarity()">
    <div id="bulkResult"></div>
</body>
</html>
